# Default бот на aiogram

**Бот с БД, интеграцией с yookassa, планировщиком, fastapi, DI**

## Функциональность сервиса

- Сохранение пользователей в БД
- Отправка сообщений через планировщик
- Покупка товаров и услуг через Yookassa

## Технологический стэк

- **Aiogram** — библиотека для бота
- **FastAPI + Pydantic** — асинхронный REST API для вебхуков
- **PostgresSQL + SQLAlchemy 2 + Alembic** — база данных и миграции
- **Poetry** — управление зависимостями и виртуальным окружением
- **Pre-commit + MyPy + Ruff** — проверка качества кода

## Архитектура

- Dependency Injection
- Слоистая архитектура

## Запуск проекта

| **Команда**                                                                             | Описание                            |
|-----------------------------------------------------------------------------------------|-------------------------------------|
| ```cp .env.example .env```                                                              | Создать .env и заполнить переменные |
| ```poetry shell```                                                                      | Создание и активация окружения      |
| ```poetry install```                                                                    | Установка зависимостей              |
| ```pre-commit install```                                                                | Установка pre-commit хуков          |
| ```uvicorn --app-dir src main:app --reload --loop asyncio --host=0.0.0.0 --port=8000``` | Запуск проекта                      |

## Переменные окружения:

| env          | Пример        | Описание                                   |
|--------------|---------------|--------------------------------------------|
| PROJECT_NAME | "bot_default  | Название проекта                           |
| BOT_TOKEN    | "A0a0a0a0..." | Токен бот                                  |
| BOT_URL      | @test_bot     | Публичная ссылка на бота                   |
| HOST         | "0.0.0.0"     | Хост на котором запускается fastapi сервер |
| PORT         | "8000"        | Порт на котором запускается fastapi сервер |

## Переменные окружения Базы данных:

| env         | Пример        | Описание                       |
|-------------|---------------|--------------------------------|
| DB_USER     | "postgres"    | Имя пользователя БД            |
| DB_PASSWORD | "postgres"    | Пароль БД                      |
| DB_HOST     | "localhost"   | Имя хоста для подключения к БД |
| DB_PORT     | "5432"        | Порт для подключения к БД      |
| DB_NAME     | "bot_default" | Имя БД                         |

## Переменные окружения Yookassa:

| env              | Пример                   | Описание                        |
|------------------|--------------------------|---------------------------------|
| SHOP_ID          | "1111111"                | Идентификатор магазина Yookassa |
| SECRET_KEY       | "A0a0a0a0..."            | Ключ для магазина Yookassa      |
| NOTIFICATION_URL | "http://test.com/server" | URL для уведомления от Yookassa |
